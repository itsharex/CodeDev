# CtxRun - 详细使用指南 (Detailed Usage Guide)

本文档提供了 CtxRun 各项核心功能的详细使用方法、配置指南和快捷键参考。

## 目录 (Table of Contents)

1.  [Context Forge (文件整合)](#1-context-forge-文件整合)
2.  [Spotlight (全局 AI 终端)](#2-spotlight-全局-ai-终端)
    *   [搜索模式 (Search Mode)](#-搜索模式-search-mode)
    *   [AI 对话模式 (AI Chat Mode)](#-ai-对话模式-ai-chat-mode)
3.  [Prompt Verse (提示词库)](#3-prompt-verse-提示词库)
4.  [Patch Weaver (AI 补全器)](#4-patch-weaver-ai-补全器)
5.  [配置指南 (Setup Guide)](#5-配置指南-setup-guide)
6.  [常用快捷键一览](#6-常用快捷键一览)

---

### 1. Context Forge (文件整合)
**解决痛点：** 快速将项目文件打包成 LLM (ChatGPT/Claude/DeepSeek) 易读的格式。

*   **文件选择**：在左侧文件树中勾选你需要让 AI 理解的代码文件或文件夹，或者通过设置设置全局过滤以及选择下方的过滤规则。
*   **智能统计**：底部仪表盘会实时显示选中文件的总大小、**预估 Token 数量**以及语言分布。
*   **Token 优化**：
    *   开启 **"Remove Comments"** 开关，自动剥离代码注释，节省大量 Token。
    *   自动识别并过滤二进制文件（如图片、PDF）。
*   **一键输出（建议下载为txt）**：点击 **Copy**，软件会将项目结构树和文件内容生成为结构化的 XML 文本，直接粘贴给 AI 即可，但是推荐导出成txt文档发送给AI。

### 2. Spotlight (全局 AI 终端)
**默认快捷键：** `Alt + S` (Windows) 或 `Option + S` (macOS)，在Linux上快捷键被阻止。快捷键可在设置中自定义。

Spotlight 是一个始终置顶的悬浮窗，拥有两种模式，按 **`Tab`** 键切换，按**`ESC`**退出：

#### 🔍 搜索模式 (Search Mode)
快速检索并使用你的指令库。
*   **搜索**：输入关键词查找本地或已下载的 Prompt/Command。
*   **执行**：对于命令指令，按`Enter`可以直接通过终端执行，执行通常是从上到下依次执行。
*   **复制**：按 `Enter` 直接将内容复制到剪贴板。

#### ✨ AI 对话模式 (AI Chat Mode)
无需切换浏览器，直接与 AI 对话。
*   **配置**：需要在设置的AI配置中配置API Key，并不是只能够配置上面名称中的模型，只要填写API地址和模型ID都能够运行任何LLM模型，推荐使用DeepSeek或者GLM的模型，GLM有免费模型可供调用。
*   **切换**：在搜索模式下按 `Tab` 键进入紫色界面的 AI 模式。
*   **对话**：输入问题并回车，体验流式打字机回复。支持 Markdown 渲染和代码高亮。
*   **思考过程**：支持 DeepSeek-R1 等推理模型，可折叠查看 AI 的 "Thinking Process"。
*   **清空上下文**：按 `Ctrl + K` (或 `Cmd + K`) 清空当前临时会话。
    *   *注意：Spotlight 主打“即用即走”，对话历史仅保存在内存中，重启软件后会自动清除。*

### 3. Prompt Verse (提示词库)
管理你的常用指令和 AI 提示词。

*   **创建与编辑**：支持创建自定义分组，编写包含变量（`{{variable}}`）的通用模板。
*   **官方商店**：在设置中进入 **Library**，下载离线的指令包（如 Linux 命令大全、编程辅助 Prompts）。
*   **遮蔽机制**：如果你收藏并修改了官方指令，本地修改将覆盖官方版本，互不冲突。
*   **命令执行**：可以创建可执行命令指令，直接点击通过终端执行，命令执行流程为从上到下，可参考![image-20251220114813692](./images/image-20251220114813692.png)本质上是一个执行脚本，理论上能够执行用户权限下的终端命令。

---

### 4. Patch Weaver
它的设计理念是填补“AI 生成代码”与“实际修改文件”之间的最后一步鸿沟，让用户无需手动复制粘贴每一处修改。

#### 核心定位
**“面向 LLM 的智能 Patch 工具”**
通过固定的句式让AI的输出直接能够融合到代码里面，无需手动复制查找粘贴。

#### 场景一：AI 补丁应用器 (AI Patch Applicator)

这是该模块最具创新性的功能，专为 AI 辅助编码设计。

##### **工作流程:**

1.  **加载项目**: 用户首先选择一个本地项目的根目录。这是定位和写入文件的基础。
2.  **获取指令**: 侧边栏提供了一个关键的 **"AI Instruction" (系统提示词)**。用户复制这个 Prompt，并附加上自己的修改需求（例如：“请帮我把这个 JS 函数改成 TS，并添加 JSDoc 注释”）一并发送给大语言模型。
3.  **粘贴 AI 响应**: LLM 会按照指示，返回包含 `<<<<<<< SEARCH ... >>>>>>> REPLACE` 块的文本。用户只需将这段文本完整地粘贴到 Patch Weaver 的输入框中。
4.  **自动解析与预览**:
    *   应用**瞬间解析**出文本中针对一个或多个文件的所有修改操作。
    *   对于每个文件，它会读取本地的原始内容，并**在内存中模拟应用补丁**。
    *   最终，在基于 Monaco Editor 的 **Diff 视图**中，清晰地向用户展示修改前后的对比。

#### 场景二：Git 版本对比器 (Git Diff Visualizer)

这是一个更传统但功能强大的 Git 可视化工具。
![ScreenShot_2025-12-20_115923_830](./images/ScreenShot_2025-12-20_115923_830.png)

##### **工作流程:**

1.  **浏览 Git 仓库**: 用户选择一个包含 `.git` 目录的本地项目。
2.  **加载提交记录**: 应用会调用 Rust 后端，通过 `git2` crate 安全地读取最近的 50 条 commit 记录并展示在下拉列表中。
3.  **选择版本**: 用户在 "Base Version" (基准) 和 "Compare Version" (比较) 两个下拉框中选择任意两个 commit。
4.  **生成对比**: 点击 "Generate Diff" 后，Rust 后端会计算这两个 commit 之间的所有文件差异，并将结构化的数据（包括文件路径、状态、新旧内容等）返回给前端。
5.  **审查与导出**:
    *   左侧列表会清晰地展示所有**新增 (A)**、**修改 (M)**、**删除 (D)**、**重命名 (R)** 的文件。
    *   应用会自动识别并标记**二进制文件**和**超大文件**，防止因加载它们而导致应用卡顿。
    *   用户可以点击任意文件，在右侧的 Diff 视图中进行详细审查。
    *   强大的**导出功能**允许用户将选中的文件差异导出为多种格式 (`Markdown`, `JSON`, `XML`, `TXT`) 和多种布局 (`Split`, `Unified`, `Git Patch`)，非常适合撰写 Code Review 报告或存档。

### 5. 配置指南 (Setup Guide)
为了使用 Spotlight 的 AI 对话功能，你需要配置模型提供商：

1.  点击左侧侧边栏底部的 **设置 (Settings)** 图标。
2.  进入 **AI Configuration** 选项卡。
3.  填写 API 信息：
    *   **Provider**: 选择 `DeepSeek` / `OpenAI` / `Anthropic` (仅作图标区分，并不是只能这三个选择)。
    *   **API Key**: 填入你的 API 密钥（数据仅存储在本地）。
    *   **Base URL**: (可选) 如果使用 **硅基流动 (SiliconFlow)** 或其他中转服务，请填写对应的 Base URL（例如 `https://api.siliconflow.cn`）。
    *   **Model ID**: 填入模型名称（例如 `deepseek-chat`）。

---

### 6. 常用快捷键一览

| 快捷键 | 作用域 | 功能 |
| :--- | :--- | :--- |
| `Alt + S` | 全局 | 唤起/隐藏 Spotlight 搜索框 |
| `Tab` | Spotlight | 切换 **搜索模式** / **AI 模式** |
| `Enter` | Spotlight | (搜索模式) 复制/执行指令 / (AI 模式) 发送消息 |
| `Ctrl + K` | Spotlight | (AI 模式) 清空当前对话历史 |
| `Esc` | 全局 | 关闭当前窗口或弹窗 |